<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paweł Wiczling*">
<meta name="dcterms.date" content="2023-09-21">

<title>Bayesing-based popPK modeling of clonidine with informative priors</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="clonidine_files/libs/clipboard/clipboard.min.js"></script>
<script src="clonidine_files/libs/quarto-html/quarto.js"></script>
<script src="clonidine_files/libs/quarto-html/popper.min.js"></script>
<script src="clonidine_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="clonidine_files/libs/quarto-html/anchor.min.js"></script>
<link href="clonidine_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="clonidine_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="clonidine_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="clonidine_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="clonidine_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#raw-data" id="toc-raw-data" class="nav-link" data-scroll-target="#raw-data">Raw Data</a></li>
  </ul></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a></li>
  <li><a href="#priors" id="toc-priors" class="nav-link" data-scroll-target="#priors">Priors</a></li>
  </ul></li>
  <li><a href="#format-data-for-stan" id="toc-format-data-for-stan" class="nav-link" data-scroll-target="#format-data-for-stan">Format data for Stan</a>
  <ul class="collapse">
  <li><a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference">Inference</a></li>
  <li><a href="#lounch-shiny" id="toc-lounch-shiny" class="nav-link" data-scroll-target="#lounch-shiny">lounch shiny</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#priors-1" id="toc-priors-1" class="nav-link" data-scroll-target="#priors-1">Priors</a></li>
  <li><a href="#posteriors" id="toc-posteriors" class="nav-link" data-scroll-target="#posteriors">Posteriors</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#individual-and-population-predictions" id="toc-individual-and-population-predictions" class="nav-link" data-scroll-target="#individual-and-population-predictions">Individual and population predictions</a></li>
  <li><a href="#individual-parameters-vs.-covariates" id="toc-individual-parameters-vs.-covariates" class="nav-link" data-scroll-target="#individual-parameters-vs.-covariates">Individual parameters vs.&nbsp;covariates</a></li>
  <li><a href="#gof" id="toc-gof" class="nav-link" data-scroll-target="#gof">GOF</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#licenses" id="toc-licenses" class="nav-link" data-scroll-target="#licenses">Licenses</a></li>
  <li><a href="#original-computing-environment" id="toc-original-computing-environment" class="nav-link" data-scroll-target="#original-computing-environment">Original Computing Environment</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Bayesing-based popPK modeling of clonidine with informative priors</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Paweł Wiczling* </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen.&nbsp;J. Hallera 107, 80-416 Gdańsk, Poland
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 21, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="setup" class="level1">
<h1>Setup</h1>
<p>The codes are based on STAN/Torsten manual <a href="https://metrumresearchgroup.github.io/Torsten/" class="uri">https://metrumresearchgroup.github.io/Torsten/</a></p>
<p>The packages we will use are listed below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Instaling Stan and Torsten might be difficult. Follow this advice in case of any troubles:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' https://discourse.mc-stan.org/t/installation-on-windows-revisited/20207</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' https://github.com/stan-dev/cmdstan/issues/909</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set_cmdstan_path</span>(<span class="st">"C:/Users/pawel/Documents/.cmdstan/Torsten-master/Torsten-master/cmdstan"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># library(shinystan)</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="do">## not required but assures repeatable results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The aim of this case study was to develop a population pharmacokinetic model of clonidine using Bayesian methods and an open-source programming environment RStudio, the programming language Stan and a library of pharmacokinetic tools Torsten.</p>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>The analyzed PK data was obtained from 17 children (Department of Pediatric Anesthesiology and Intensive Care in Poznan). The results presented in the publication by Potts et al. <span class="citation" data-cites="potts_clonidine_2007">(<a href="#ref-potts_clonidine_2007" role="doc-biblioref">Potts <em>et al.</em>, 2007</a>)</span> were used as a prior information (a meta-analysis of five studies conducted in Sweden and New Zealand). The head of the analyzed data:</p>
<div class="cell" data-hash="clonidine_cache/html/load-data_23cc63a8c05e3a22ad2224f6594813e8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>xdata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/data-clonidine.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(xdata)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"ID"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>xdata<span class="sc">$</span>TINF <span class="ot">&lt;-</span> xdata<span class="sc">$</span>TINF<span class="sc">/</span><span class="dv">60</span>;</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>xdata<span class="sc">$</span>DV <span class="ot">&lt;-</span> xdata<span class="sc">$</span>DV<span class="sc">/</span><span class="dv">1000</span>;</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>xdata<span class="sc">$</span>MDV[<span class="dv">107</span>] <span class="ot">&lt;-</span> <span class="dv">1</span>;</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>xdata<span class="sc">$</span>EVID[<span class="dv">107</span>] <span class="ot">&lt;-</span> <span class="dv">1</span>;</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>xdata<span class="sc">$</span>OUTLIERS <span class="ot">=</span> xdata<span class="sc">$</span>DV<span class="sc">&gt;</span><span class="dv">20</span>;</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>xdata<span class="sc">$</span>INFUSION <span class="ot">=</span> xdata<span class="sc">$</span>TIMEh<span class="sc">&lt;</span>xdata<span class="sc">$</span>TINF;</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>xdata<span class="sc">$</span>TIMEPOST <span class="ot">=</span> xdata<span class="sc">$</span>TIMEh<span class="sc">-</span>xdata<span class="sc">$</span>TINF;</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     ID       DATE     HOUR TIME     TIMEh DAY   AMT RATE   DV M1F2 AGEM WT
1 10002 08.11.2016 13:20:00    0  0.000000   1  26.6 22.8 0.00    1   72 21
2 10002 08.11.2016 14:30:00   70  1.166667   1  24.3 32.4 0.00    1   72 21
3 10002 08.11.2016 15:15:00  115  1.916667   1 297.6 37.2 0.00    1   72 21
4 10002 08.11.2016 17:20:00  240  4.000000   1   0.0  0.0 1.52    1   72 21
5 10002 08.11.2016 23:15:00  595  9.916667   1   0.0  0.0 2.28    1   72 21
6 10002 08.11.2016 23:20:00  600 10.000000   1   0.0  0.0 2.25    1   72 21
  HEIG     TINF  DOSE INOT MID INHIB SBPB DBPB HRB MAPB     SBPM     DBPM HRM
1    0 9.916667 352.5    2   1     1  122   73  90   97 105.6364 59.18182  97
2    0 9.916667 352.5    2   1     1  122   73  90   97 105.6364 59.18182  97
3    0 9.916667 352.5    2   1     1  122   73  90   97 105.6364 59.18182  97
4    0 9.916667 352.5    2   1     1  122   73  90   97 105.6364 59.18182  97
5    0 9.916667 352.5    2   1     1  122   73  90   97 105.6364 59.18182  97
6    0 9.916667 352.5    2   1     1  122   73  90   97 105.6364 59.18182  97
      MAPM ALAT ASPAT MOCZN BILIR   KR CLKRS C1A12A C1A12C C2D610 C2D62 C2D641
1 74.66667   21    34    20 0.366 0.34     0      1      1      2     1      1
2 74.66667   21    34    20 0.366 0.34     0      1      1      2     1      1
3 74.66667   21    34    20 0.366 0.34     0      1      1      2     1      1
4 74.66667   21    34    20 0.366 0.34     0      1      1      2     1      1
5 74.66667   21    34    20 0.366 0.34     0      1      1      2     1      1
6 74.66667   21    34    20 0.366 0.34     0      1      1      2     1      1
  C2D64 C1A21F ADR2A ADR1A MDV EVID DVC OUTLIERS INFUSION      TIMEPOST
1     2      3     1     2   1    1   0    FALSE     TRUE -9.916667e+00
2     2      3     1     2   1    1   0    FALSE     TRUE -8.750000e+00
3     2      3     1     2   1    1   0    FALSE     TRUE -8.000000e+00
4     2      3     1     2   0    0   1    FALSE     TRUE -5.916667e+00
5     2      3     1     2   0    0   1    FALSE    FALSE  3.333333e-07
6     2      3     1     2   0    0   1    FALSE    FALSE  8.333333e-02</code></pre>
</div>
</div>
<section id="raw-data" class="level2">
<h2 class="anchored" data-anchor-id="raw-data">Raw Data</h2>
<p>First a simple graphical presentation of the data. Red plots denote outliers of unknown origin.</p>
<div class="cell" data-hash="clonidine_cache/html/plot-raw-data_6d8631a30c76869ddaa1c712cf0c4ae7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>plot1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">subset</span>(xdata, EVID <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> OUTLIERS<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> INFUSION<span class="sc">==</span><span class="dv">1</span>), </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> TIMEh, <span class="at">y =</span> DV, <span class="at">group =</span> ID)) <span class="sc">+</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(xdata, EVID <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> OUTLIERS<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> INFUSION<span class="sc">==</span><span class="dv">1</span>), </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> TIMEh, <span class="at">y =</span> DV, <span class="at">group =</span> ID),<span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">250</span>))<span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Clonindne, ng/ml"</span>) <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time after infutions start, h"</span>) <span class="sc">+</span> </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>plot2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">subset</span>(xdata, EVID <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> OUTLIERS<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> INFUSION<span class="sc">==</span><span class="dv">0</span>), </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> TIMEPOST, <span class="at">y =</span> DV, <span class="at">group =</span> ID)) <span class="sc">+</span> </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(xdata, EVID <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> OUTLIERS<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> INFUSION<span class="sc">==</span><span class="dv">0</span>), </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> TIMEPOST, <span class="at">y =</span> DV, <span class="at">group =</span> ID),<span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">250</span>))<span class="sc">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Clonindne, ng/ml"</span>) <span class="sc">+</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time after infusion end, h"</span>)<span class="sc">+</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>plot12 <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(plot1, plot2, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/plot-raw-data-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../deliv/figures/raw-data.png"</span>, </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot=</span>plot12, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">15</span>, <span class="at">height =</span> <span class="dv">15</span>, <span class="at">units =</span> <span class="st">"cm"</span>,  <span class="at">dpi=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<p>The data was analyzed using a 2 comp. PK model [1].</p>
<p><span class="math display">\[
\begin{aligned}
&amp; V_1 \cdot \frac{dC_1}{dt} = Input(t) - CL \cdot  C_1 - Q \cdot  C_1 + Q \cdot  C_2 \\
&amp; V_2 \cdot \frac{dC_2}{dt} =  Q \cdot  C1 - Q \cdot  C_2
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(C_1\)</span> and <span class="math inline">\(C_2\)</span> denote clonidine concentrations in plasma and peripheral compartment. <span class="math inline">\(Input(t)\)</span> denotes clonidine dosing specific for a patient. The statistical model has the following structure (hierarchical model):</p>
<p><span class="math display">\[
\begin{aligned}
&amp; \log C_{Obs_{i,j}} \sim student_t(\nu_1,f_1(P_{i},t_{i,j}),\sigma_1) \\
&amp; \log P_{i} \sim \text{MVN}(\log \theta_P + logfr_P+ allo_P \cdot \log(BW_i/70) + maturation_i, \Omega) \\
&amp; maturation_i = log(1-(1-\beta) \cdot exp(-(4 \cdot AGE_i) \cdot 0.693/Tcl)) \ for \ CL \ only
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(P_i=(CL_{i}, Q_{i}, V1_{i}, V2_{i})\)</span> is a vector of subject-specific parameters, <span class="math inline">\(f_1(.)\)</span> corresponds to the above ODE equations, <span class="math inline">\(MVN\)</span> is a multivariate normal distribution, <span class="math inline">\(\theta_P\)</span> is a vector of typical values of <span class="math inline">\(P_i\)</span>, <span class="math inline">\(allo_p\)</span> is a vector of slopes between <span class="math inline">\(P_i\)</span> and <span class="math inline">\(BW_i\)</span>. <span class="math inline">\(maturation_i\)</span> denotes a maturation function for CL. In turn, <span class="math inline">\(\sigma\)</span> is the scale and <span class="math inline">\(\Omega\)</span> is the scale matrix for the random effects related to the residual and unexplained between-subject variability. <span class="math inline">\(fr_{P}\)</span> is the difference between the literature and studied population. For convenience <span class="math inline">\(\Omega\)</span> was decomposed to:</p>
<p><span class="math display">\[
\Omega = diag(\omega) \cdot LL' \cdot diag(\omega)
\]</span></p>
<p>where <span class="math inline">\(\rho = LL'\)</span> denotes correlation, <span class="math inline">\(L\)</span> is a lower triangular Cholesky factor for a correlation matrix and <span class="math inline">\(\omega\)</span> denotes standard deviation for between subject variability.</p>
</section>
<section id="priors" class="level2">
<h2 class="anchored" data-anchor-id="priors">Priors</h2>
<p>The priors were specified based on parameter estimates provided by Potts et al. <span class="citation" data-cites="potts_clonidine_2007">(<a href="#ref-potts_clonidine_2007" role="doc-biblioref">Potts <em>et al.</em>, 2007</a>)</span>.</p>
<p><span class="math display">\[
\begin{aligned}
&amp; \theta_{CL} \sim lognormal(log(14.6),0.06), \\
&amp; \theta_{Q} \sim lognormal(log(157),0.111), \\
&amp; \theta_{V1} \sim lognormal(log(62.5),0.17), \\
&amp; \theta_{V2} \sim lognormal(log(119),0.087), \\
&amp; \beta \sim lognormal(log(0.262),0.274), \\
&amp; Tcl \sim lognormal(log(25.7),0.294), \\
&amp; fr_{CL}, fr_{Q},fr_{V1},fr_{V2} \sim lognormal(log(1),0.25), \\
&amp; \nu \sim gamma(2,0.1),\\
&amp; \omega_{CL}\sim lognormal(log(0.351),0.25), \\
&amp; \omega_{Q} \sim lognormal(log(0.773),0.25), \\
&amp; \omega_{V_1} \sim lognormal(log(0.711),0.25), \\
&amp; \omega_{V_2} \sim lognormal(log(0.229),0.25), \\
&amp; allo_{CL},allo_{Q} \sim normal(0.75,0.05), \\
&amp; allo_{V_1}, allo_{V_2} \sim normal(1,0.05), \\
&amp; \sigma_{1}\sim lognormal(log(0.2),0.05), \\
&amp; p(LL') \propto LKJ(4) \cdot \Pi_u N(c_u, 0.125), \\
&amp; c_u = [0.538,-0.036,0.323,-0.110,-0.199,-0.144]
  \end{aligned}
\]</span></p>
<p>LKJ(4) ensure that the density is uniform over correlation matrices of order 4 and u denotes the unique lower triangular elements of correlation matrix (<a href="http://srmart.in/informative-priors-for-correlation-matrices-an-easy-approach/" class="uri">http://srmart.in/informative-priors-for-correlation-matrices-an-easy-approach/</a>)</p>
<p><span class="math inline">\(fr\)</span> is a form of a commensurate prior <span class="citation" data-cites="hobbs_commensurate_2012">(<a href="#ref-hobbs_commensurate_2012" role="doc-biblioref">Hobbs, Sargent and Carlin, 2012</a>)</span>.</p>
</section>
</section>
<section id="format-data-for-stan" class="level1">
<h1>Format data for Stan</h1>
<div class="cell" data-hash="clonidine_cache/html/standata_aaa8c3900bbf70e83901ea93ee48a71c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>xdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(xdata, OUTLIERS <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' Format data for Stan</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>nt <span class="ot">&lt;-</span> <span class="fu">nrow</span>(xdata)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>iObs <span class="ot">&lt;-</span> <span class="fu">with</span>(xdata, (<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(xdata))[EVID <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(iObs)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>xsub <span class="ot">&lt;-</span> <span class="fu">subset</span>(xdata, <span class="sc">!</span><span class="fu">duplicated</span>(ID))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>nSubjects <span class="ot">&lt;-</span> <span class="fu">length</span>(xsub<span class="sc">$</span>ID)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nt)[<span class="sc">!</span><span class="fu">duplicated</span>(xdata<span class="sc">$</span>ID)]</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nt)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>nIIV <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>weight<span class="ot">&lt;-</span> xdata<span class="sc">$</span>WT</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> xdata<span class="sc">$</span>AGEM</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> xdata<span class="sc">$</span>TIMEh</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>cObs <span class="ot">&lt;-</span> xdata<span class="sc">$</span>DV[iObs]</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>amt <span class="ot">&lt;-</span>  xdata<span class="sc">$</span>AMT</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>rate <span class="ot">&lt;-</span> xdata<span class="sc">$</span>RATE</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>cmt <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">+</span>xdata<span class="sc">$</span>AGEM<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>evid <span class="ot">&lt;-</span> xdata<span class="sc">$</span>EVID</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>ii <span class="ot">&lt;-</span> xdata<span class="sc">$</span>AGEM<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>addl <span class="ot">&lt;-</span> xdata<span class="sc">$</span>AGEM<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> xdata<span class="sc">$</span>AGEM<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>runestimation<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">#' create stan data set</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a> data_list <span class="ot">&lt;-</span> <span class="fu">with</span>(xdata,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>             <span class="fu">list</span>(<span class="at">nt =</span> nt,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nObs =</span> nObs,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nSubjects =</span> nSubjects,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nIIV =</span> <span class="dv">4</span>,</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>                  <span class="at">iObs =</span> iObs,</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> start,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>                  <span class="at">end =</span> end,</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>                  <span class="at">weight=</span> WT,</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">age =</span> AGEM,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>                  <span class="at">time =</span> TIMEh,</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cObs =</span> DV[iObs],</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>                  <span class="at">amt =</span>  AMT,</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>                  <span class="at">rate =</span> RATE,</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cmt =</span> <span class="dv">2</span><span class="sc">+</span>AGEM<span class="sc">*</span><span class="dv">0</span>,</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">evid =</span> EVID,</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ii =</span> AGEM<span class="sc">*</span><span class="dv">0</span>,</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>                  <span class="at">addl =</span> AGEM<span class="sc">*</span><span class="dv">0</span>,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ss =</span> AGEM<span class="sc">*</span><span class="dv">0</span>,</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>                  <span class="at">runestimation=</span><span class="dv">1</span>))</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(data_list, <span class="st">"../standata/model_data.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>data_list<span class="sc">$</span>runestimation<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(data_list, <span class="st">"../standata/prior_model_data.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="co">#' create initial estimates</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">CLHat =</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="fl">14.6</span>),<span class="fl">0.25</span>)),</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>       <span class="at">QHat =</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="dv">157</span>),<span class="fl">0.5</span>)),</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>       <span class="at">V1Hat =</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="fl">62.5</span>),<span class="fl">0.5</span>)),</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>       <span class="at">V2Hat =</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="dv">119</span>),<span class="fl">0.5</span>)),</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>       <span class="at">betaHat =</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="fl">0.262</span>),<span class="fl">0.25</span>)),</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>       <span class="at">TclHat =</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fu">log</span>(<span class="fl">25.7</span>),<span class="fl">0.25</span>)),</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>       <span class="at">allo =</span> <span class="fu">c</span>(<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">4</span>,<span class="dv">0</span>,<span class="fl">0.25</span>)),</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>       <span class="at">fr =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">4</span>,<span class="dv">0</span>,<span class="fl">0.25</span>)),</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>       <span class="at">nu =</span> <span class="fu">max</span>(<span class="dv">3</span>,<span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="fl">0.1</span>)),</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>       <span class="at">omega =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>) <span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="fl">0.25</span>)),</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>       <span class="at">L =</span> <span class="fu">diag</span>(<span class="dv">4</span>),</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>       <span class="at">sigma =</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fu">log</span>(<span class="fl">0.2</span>),<span class="fl">0.25</span>)),</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>       <span class="at">etaStd =</span> <span class="fu">matrix</span>(0L, <span class="dv">4</span>, nSubjects))</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The Stan/Torsten model is as follows:</p>
<div class="cell" data-hash="clonidine_cache/html/stancode_82bc4486a7bb967284cb9fbf694a50e2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="fu">readLines</span>(<span class="st">"../model/clonidine.stan"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>functions {

// credit http://srmart.in/informative-priors-for-correlation-matrices-an-easy-approach/
  vector lower_tri(matrix mat) {
    int d = rows(mat);
    int lower_tri_d = d * (d - 1) / 2;
    vector[lower_tri_d] lower;
    int count = 1;
    for(r in 2:d) {
      for(c in 1:(r - 1)) {
    lower[count] = mat[r,c];
    count += 1;
      }
    }
    return(lower);
 }

real lkj_corr_cholesky_point_lower_tri_lpdf(matrix cor_L, vector point_mu_lower, vector point_scale_lower) {
    real lpdf = lkj_corr_cholesky_lpdf(cor_L | 1);
    int d = rows(cor_L);
    matrix[d,d] cor = multiply_lower_tri_self_transpose(cor_L);
    lpdf += normal_lpdf(lower_tri(cor) | point_mu_lower, point_scale_lower);
    return(lpdf);
 }
}

data{
  int&lt;lower = 1&gt; nt;
  int&lt;lower = 1&gt; nObs;
  int&lt;lower = 1&gt; nSubjects;
  int nIIV;
  int&lt;lower = 1&gt; iObs[nObs];
  int&lt;lower = 1&gt; start[nSubjects];
  int&lt;lower = 1&gt; end[nSubjects];
  int&lt;lower = 1&gt; cmt[nt];
  int evid[nt];
  int addl[nt];
  int ss[nt];
  real amt[nt];
  real time[nt];
  real rate[nt];
  real ii[nt];
  real weight[nt];
  real age[nt];
  vector&lt;lower = 0&gt;[nObs] cObs;
  int&lt;lower = 0, upper = 1&gt; runestimation; //   a switch to evaluate the likelihood

}

transformed data{
  vector[nObs] logCObs = log(cObs);
  int nTheta = 5;
  int nCmt = 3;
  int nti[nSubjects];
  real biovar[nCmt];
  real tlag[nCmt];
  vector[6] point_mu_lower = [0.538,-0.036,0.323,-0.110,-0.199,-0.144]';
  vector[6] point_scale_lower = [0.25,0.25,0.25,0.25,0.25,0.25]';

  for(i in 1:nSubjects) nti[i] = end[i] - start[i] + 1;

  for (i in 1:nCmt) {
    biovar[i] = 1;
    tlag[i] = 0;
 }
}
parameters{
  real&lt;lower = 0, upper = 500&gt; CLHat;
  real&lt;lower = 0, upper = 500&gt; QHat;
  real&lt;lower = 0, upper = 3500&gt; V1Hat;
  real&lt;lower = 0, upper = 3500&gt; V2Hat;
  real&lt;lower = 0, upper = 5&gt; betaHat;
  real&lt;lower = 0, upper = 100&gt; TclHat;
  real&lt;lower = 0&gt; allo[4];
  real&lt;lower = 0&gt; fr[4];
  real&lt;lower = 0&gt; sigma;
  real&lt;lower = 3&gt;  nu; // normality constant

// Inter-Individual variability
  vector&lt;lower = 0.01, upper = 2&gt;[nIIV] omega;
  matrix[nIIV, nSubjects] etaStd;
  cholesky_factor_corr[nIIV] L;
}

transformed parameters{
  vector&lt;lower = 0&gt;[nIIV] thetaHat;
  matrix&lt;lower = 0&gt;[nSubjects, nIIV] etaM; // variable required for Matt's trick
  real&lt;lower = 0&gt; theta[nTheta];
  matrix&lt;lower = 0&gt;[nCmt, nt] x;
  row_vector&lt;lower = 0&gt;[nt] cHat;
  row_vector&lt;lower = 0&gt;[nObs] cHatObs;

  thetaHat[1] = CLHat;
  thetaHat[2] = QHat;
  thetaHat[3] = V1Hat;
  thetaHat[4] = V2Hat;

 // Matt's trick to use unit scale 
  etaM =  exp(diag_pre_multiply(omega, L * etaStd))'; 
  
  for(j in 1:nSubjects)
  {

    theta[1] = thetaHat[1] * etaM[j, 1] * fr[1] * (weight[start[j]] / 70)^allo[1] * (1-(1-betaHat)*exp(-(4*age[start[j]])*0.693/TclHat)); // CL
    theta[2] = thetaHat[2] * etaM[j, 2] * fr[2] * (weight[start[j]] / 70)^allo[2]; // Q
    theta[3] = thetaHat[3] * etaM[j, 3] * fr[3] * (weight[start[j]] / 70)^allo[3]; // V1
    theta[4] = thetaHat[4] * etaM[j, 4] * fr[4] * (weight[start[j]] / 70)^allo[4]; // V2
    theta[5] = 0; // ka

    x[,start[j]:end[j]] = pmx_solve_twocpt(time[start[j]:end[j]], 
                                       amt[start[j]:end[j]],
                                       rate[start[j]:end[j]],
                                       ii[start[j]:end[j]],
                                       evid[start[j]:end[j]],
                                       cmt[start[j]:end[j]],
                                       addl[start[j]:end[j]],
                                       ss[start[j]:end[j]],
                                       theta, biovar, tlag);
                                       
    cHat[start[j]:end[j]] = x[2,start[j]:end[j]] ./ theta[3]; // divide by V1
  }

  cHatObs  = cHat[iObs];
}

model{
  //Informative Priors
  CLHat ~ lognormal(log(14.6),0.06);
  QHat  ~ lognormal(log(157),0.111);
  V1Hat ~ lognormal(log(62.5),0.17);
  V2Hat ~ lognormal(log(119),0.087);
  betaHat ~ lognormal(log(0.262),0.274);
  TclHat ~ lognormal(log(25.7),0.294);
  
  fr ~ lognormal(log(1),0.25);

  L~lkj_corr_cholesky_point_lower_tri(point_mu_lower, point_scale_lower);

  nu ~ gamma(2,0.1);

 // Inter-individual variability (see transformed parameters block
 // for translation to PK parameters)

  to_vector(etaStd) ~ normal(0, 1);

  omega[1] ~ lognormal(log(0.351),0.25);
  omega[2] ~ lognormal(log(0.773),0.25);
  omega[3] ~ lognormal(log(0.711),0.25);
  omega[4] ~ lognormal(log(0.229),0.25); 

  allo[1] ~ normal(0.75,0.125);
  allo[2] ~ normal(0.75,0.125);
  allo[3] ~ normal(1,0.125);
  allo[4] ~ normal(1,0.125);

  sigma ~ lognormal(log(0.10), 0.25);

  if(runestimation==1){
    logCObs ~ student_t(nu,log(cHatObs), sigma);
  }
}

generated quantities{
    real cObsCond[nObs];
 //   real log_lik[nObs];
    row_vector[nt] cHatPred;
    real cObsPred[nObs];
    row_vector&lt;lower = 0&gt;[nObs] cHatObsPred;
    matrix[nCmt,nt] xPred;
    matrix[nIIV, nSubjects] etaStdPred;
    matrix&lt;lower=0&gt;[nSubjects, nIIV] etaPredM;
    corr_matrix[nIIV] rho;
    real&lt;lower = 0&gt; thetaPred[nTheta];

    rho = L * L';

    for(i in 1:nSubjects){
      for(j in 1:nIIV){ 
        etaStdPred[j, i] = normal_rng(0, 1);
      }
    }

    etaPredM = exp(diag_pre_multiply(omega, L * etaStdPred))';

    for(j in 1:nSubjects){

      thetaPred[1] = thetaHat[1] * etaPredM[j,1] * (weight[start[j]] / 70)^allo[1] * (1-(1-betaHat)*exp(-(4*age[start[j]])*0.693/TclHat)); // CL
      thetaPred[2] = thetaHat[2] * etaPredM[j,2] * (weight[start[j]] / 70)^allo[2]; // Q 
      thetaPred[3] = thetaHat[3] * etaPredM[j,3] * (weight[start[j]] / 70)^allo[3]; // V1
      thetaPred[4] = thetaHat[4] * etaPredM[j,4] * (weight[start[j]] / 70)^allo[4]; // V2
      thetaPred[5] = 0; // ka 
    
      xPred[,start[j]:end[j]] = pmx_solve_twocpt(time[start[j]:end[j]],
                                              amt[start[j]:end[j]],
                                              rate[start[j]:end[j]],
                                              ii[start[j]:end[j]],
                                              evid[start[j]:end[j]],
                                              cmt[start[j]:end[j]],
                                              addl[start[j]:end[j]],
                                              ss[start[j]:end[j]],
                                              thetaPred, biovar, tlag);

     cHatPred[start[j]:end[j]] = xPred[2,start[j]:end[j]] ./ thetaPred[3];
  }
  
cHatObsPred = cHatPred[iObs];

  for(i in 1:nObs){
      cObsCond[i] = exp(student_t_rng(nu,log(fmax(machine_precision(),cHatObs[i])), sigma)); // individual predictions
      cObsPred[i] = exp(student_t_rng(nu,log(fmax(machine_precision(),cHatObsPred[i])), sigma)); // population predictions
//   log_lik[i] = student_t_lpdf(cObs[i] | nu, log(fmax(machine_precision(),cHatObs[i])), sigma);  
  }
}</code></pre>
</div>
</div>
<section id="inference" class="level2">
<h2 class="anchored" data-anchor-id="inference">Inference</h2>
<div class="cell" data-hash="clonidine_cache/html/compile-model_f75c0e4ab7a39a21e35294e18d27eb4a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="st">"../model/clonidine.stan"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="clonidine_cache/html/inferences_913fd5aed5ad3a341abf1f25503302bd">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> model<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">"../standata/model_data.json"</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.9</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  fit0 <span class="ot">&lt;-</span> model<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">"../standata/prior_model_data.json"</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">#' save</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a> fit<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">"../standata/fit.RDS"</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a> fit0<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">"../standata/fit0.RDS"</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co">#' save stanfit obj for shiny</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a> stanfit <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">read_stan_csv</span>(fit<span class="sc">$</span><span class="fu">output_files</span>())</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a> <span class="fu">saveRDS</span>(stanfit, <span class="st">"../standata/stanfit.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="clonidine_cache/html/loadfits_8921724425a38c9f456de01138a2bd21">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' fit is read back using readRDS - for speed</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../standata/fit.RDS"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a> fit0 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../standata/fit0.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="lounch-shiny" class="level2">
<h2 class="anchored" data-anchor-id="lounch-shiny">lounch shiny</h2>
<div class="cell" data-hash="clonidine_cache/html/shiny_3fed5561e8260f9ab6e44ab5025ae5fb">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(shinystan)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a> stanfit<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"../standata/stanfit.RDS"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">launch_shinystan</span>(stanfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="priors-1" class="level2">
<h2 class="anchored" data-anchor-id="priors-1">Priors</h2>
<div class="cell" data-hash="clonidine_cache/html/plotprior_a11009fc17be4ac4ccc8b4c4dce75471">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit0<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"CLHat"</span>,<span class="st">"QHat"</span>,<span class="st">"V1Hat"</span>,<span class="st">"V2Hat"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/plotprior-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit0<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"betaHat"</span>,<span class="st">"TclHat"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/plotprior-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit0<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"fr"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/plotprior-3.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit0<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"sigma"</span>,<span class="st">"nu"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/plotprior-4.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit0<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"omega"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/plotprior-5.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit0<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"allo"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/plotprior-6.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit0<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"rho"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/plotprior-7.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="posteriors" class="level2">
<h2 class="anchored" data-anchor-id="posteriors">Posteriors</h2>
<div class="cell" data-hash="clonidine_cache/html/plotposterior_6d1a760fa4a490e07e62e9824a42512f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"CLHat"</span>,<span class="st">"QHat"</span>,<span class="st">"V1Hat"</span>,<span class="st">"V2Hat"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/plotposterior-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"betaHat"</span>,<span class="st">"TclHat"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/plotposterior-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"fr"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/plotposterior-3.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"sigma"</span>,<span class="st">"nu"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/plotposterior-4.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"omega"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/plotposterior-5.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"allo"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/plotposterior-6.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"rho"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/plotposterior-7.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<div class="cell" data-hash="clonidine_cache/html/summary_9147c2736d93b4d63a243d46763f35d9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="fu">c</span>(<span class="st">"CLHat"</span>,<span class="st">"QHat"</span>,<span class="st">"V1Hat"</span>,<span class="st">"V2Hat"</span>, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">"betaHat"</span>,<span class="st">"TclHat"</span>, <span class="st">"fr"</span>, <span class="st">"sigma"</span>, </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"nu"</span>, <span class="st">"omega"</span>, <span class="st">"allo"</span>, <span class="st">"rho"</span>), <span class="at">max_rows =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> variable   mean median    sd   mad     q5    q95 rhat ess_bulk ess_tail
 CLHat     14.68  14.64  0.85  0.85  13.33  16.13 1.00     6901     2939
 QHat     156.86 155.95 17.26 17.42 129.96 186.45 1.00     6770     3191
 V1Hat     63.29  62.37 10.60 10.39  47.60  82.31 1.00     6960     3050
 V2Hat    125.40 124.82 10.79 10.82 108.77 144.17 1.00     8194     2559
 betaHat    0.28   0.27  0.08  0.07   0.17   0.41 1.00     6120     2764
 TclHat    25.27  24.36  6.86  6.40  15.62  37.52 1.00     3402     3108
 fr[1]      1.07   1.06  0.17  0.17   0.81   1.37 1.00     2485     2352
 fr[2]      0.98   0.96  0.22  0.21   0.66   1.38 1.00     4562     3169
 fr[3]      1.02   0.99  0.24  0.23   0.67   1.43 1.00     4755     2699
 fr[4]      1.52   1.51  0.30  0.30   1.08   2.04 1.00     4322     2863
 sigma      0.15   0.15  0.01  0.01   0.13   0.17 1.00     3846     3243
 nu         3.57   3.39  0.60  0.41   3.03   4.66 1.00     3200     2203
 omega[1]   0.29   0.29  0.05  0.05   0.22   0.38 1.00     2338     2533
 omega[2]   0.74   0.72  0.18  0.18   0.48   1.07 1.00     3083     2393
 omega[3]   0.71   0.70  0.16  0.15   0.48   1.00 1.00     4599     3419
 omega[4]   0.27   0.26  0.07  0.07   0.17   0.39 1.00     3377     3260
 allo[1]    0.73   0.73  0.09  0.09   0.57   0.88 1.00     2671     2463
 allo[2]    0.77   0.77  0.12  0.11   0.58   0.96 1.00     5757     2815
 allo[3]    1.07   1.07  0.11  0.11   0.89   1.25 1.00     5977     3064
 allo[4]    1.02   1.02  0.10  0.10   0.87   1.18 1.00     4518     2770
 rho[1,1]   1.00   1.00  0.00  0.00   1.00   1.00   NA       NA       NA
 rho[2,1]   0.44   0.44  0.21  0.21   0.07   0.77 1.00     3978     2391
 rho[3,1]  -0.04  -0.04  0.22  0.23  -0.40   0.32 1.00     3560     3114
 rho[4,1]  -0.12  -0.13  0.21  0.21  -0.46   0.22 1.00     4272     3186
 rho[1,2]   0.44   0.44  0.21  0.21   0.07   0.77 1.00     3978     2391
 rho[2,2]   1.00   1.00  0.00  0.00   1.00   1.00   NA       NA       NA
 rho[3,2]   0.25   0.26  0.23  0.23  -0.14   0.61 1.00     3116     3162
 rho[4,2]  -0.19  -0.19  0.23  0.24  -0.57   0.19 1.00     2503     2601
 rho[1,3]  -0.04  -0.04  0.22  0.23  -0.40   0.32 1.00     3560     3114
 rho[2,3]   0.25   0.26  0.23  0.23  -0.14   0.61 1.00     3116     3162

 # showing 30 of 36 rows (change via 'max_rows' argument or 'cmdstanr_max_rows' option)</code></pre>
</div>
</div>
</section>
<section id="individual-and-population-predictions" class="level2">
<h2 class="anchored" data-anchor-id="individual-and-population-predictions">Individual and population predictions</h2>
<div class="cell" data-hash="clonidine_cache/html/concordanceplots_3ecb28d5af5246408839d5cbbab2bab3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>yrepCond1 <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"cObsCond"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"cObsCond"</span>)) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>yrepPred1 <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"cObsPred"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"cObsPred"</span>)) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> xdata<span class="sc">$</span>TIME[iObs]  <span class="co">#(read from data)</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> xdata<span class="sc">$</span>ID[iObs]   <span class="co">#(read from data)</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">unique</span>(id)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (z <span class="cf">in</span> <span class="fu">seq_along</span>(idx)) {</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  yobs <span class="ot">&lt;-</span> xdata<span class="sc">$</span>DV[iObs] </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  ktore <span class="ot">&lt;-</span> (id <span class="sc">==</span> idx[z])</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> bayesplot<span class="sc">::</span><span class="fu">ppc_ribbon</span>(<span class="at">y =</span> yobs[ktore], <span class="at">yrep =</span> yrepCond1[, ktore], <span class="at">x =</span> t[ktore]) <span class="sc">+</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="st">"Time (h)"</span>) <span class="sc">+</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"Clonidine (ng/ml)"</span>) <span class="sc">+</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> t[ktore], <span class="at">y =</span> yobs[ktore]), <span class="at">mapping =</span> <span class="fu">aes</span>(x, y), <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggtitle</span>(<span class="fu">sprintf</span>(<span class="st">"Individual, id=%d"</span>, idx[z])) <span class="sc">+</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expand_limits</span>(<span class="at">y=</span><span class="dv">0</span>)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> bayesplot<span class="sc">::</span><span class="fu">ppc_ribbon</span>(<span class="at">y =</span> yobs[ktore], <span class="at">yrep =</span> yrepPred1[, ktore], <span class="at">x =</span> t[ktore]) <span class="sc">+</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="st">"Time (h)"</span>)<span class="sc">+</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> t[ktore], <span class="at">y =</span> yobs[ktore]), <span class="at">mapping =</span> <span class="fu">aes</span>(x, y), <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggtitle</span>(<span class="fu">sprintf</span>(<span class="st">"Population, id=%d"</span>, idx[z]))<span class="sc">+</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expand_limits</span>(<span class="at">y=</span><span class="dv">0</span>)</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>  plot12 <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(<span class="at">grobs =</span> <span class="fu">list</span>(p1, p2), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">"../deliv/figures/concordance-plots-id-"</span>, idx[z],<span class="st">".png"</span>),</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot=</span>plot12, </span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">15</span>, <span class="at">height =</span> <span class="dv">15</span>, <span class="at">units =</span> <span class="st">"cm"</span>,  <span class="at">dpi=</span><span class="dv">300</span>)</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-3.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-4.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-5.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-6.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-7.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-8.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-9.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-10.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-11.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-12.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-13.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-14.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-15.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-16.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/concordanceplots-17.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="individual-parameters-vs.-covariates" class="level2">
<h2 class="anchored" data-anchor-id="individual-parameters-vs.-covariates">Individual parameters vs.&nbsp;covariates</h2>
<div class="cell" data-hash="clonidine_cache/html/covariets_21011dab4f49cdee819a1f103943199e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>thetaM<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">log</span>(<span class="fu">matrix</span>(fit<span class="sc">$</span><span class="fu">summary</span>(<span class="st">"etaM"</span>)<span class="sc">$</span>mean, <span class="at">nrow =</span> <span class="fu">length</span>(start))))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>q5thetaM<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">log</span>(<span class="fu">matrix</span>(fit<span class="sc">$</span><span class="fu">summary</span>(<span class="st">"etaM"</span>)<span class="sc">$</span>q5, <span class="at">nrow =</span> <span class="fu">length</span>(start))))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>q95thetaM<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">log</span>(<span class="fu">matrix</span>(fit<span class="sc">$</span><span class="fu">summary</span>(<span class="st">"etaM"</span>)<span class="sc">$</span>q95, <span class="at">nrow =</span> <span class="fu">length</span>(start))))</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(thetaM)[<span class="fu">names</span>(thetaM) <span class="sc">==</span> <span class="st">'X1'</span>] <span class="ot">&lt;-</span> <span class="st">'etaCL'</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(thetaM)[<span class="fu">names</span>(thetaM) <span class="sc">==</span> <span class="st">'X2'</span>] <span class="ot">&lt;-</span> <span class="st">'etaQ'</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(thetaM)[<span class="fu">names</span>(thetaM) <span class="sc">==</span> <span class="st">'X3'</span>] <span class="ot">&lt;-</span> <span class="st">'etaV1'</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(thetaM)[<span class="fu">names</span>(thetaM) <span class="sc">==</span> <span class="st">'X4'</span>] <span class="ot">&lt;-</span> <span class="st">'etaV2'</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q5thetaM)[<span class="fu">names</span>(q5thetaM) <span class="sc">==</span> <span class="st">'X1'</span>] <span class="ot">&lt;-</span> <span class="st">'etaCL5'</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q5thetaM)[<span class="fu">names</span>(q5thetaM) <span class="sc">==</span> <span class="st">'X2'</span>] <span class="ot">&lt;-</span> <span class="st">'etaQ5'</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q5thetaM)[<span class="fu">names</span>(q5thetaM) <span class="sc">==</span> <span class="st">'X3'</span>] <span class="ot">&lt;-</span> <span class="st">'etaV15'</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q5thetaM)[<span class="fu">names</span>(q5thetaM) <span class="sc">==</span> <span class="st">'X4'</span>] <span class="ot">&lt;-</span> <span class="st">'etaV25'</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q95thetaM)[<span class="fu">names</span>(q95thetaM) <span class="sc">==</span> <span class="st">'X1'</span>] <span class="ot">&lt;-</span> <span class="st">'etaCL95'</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q95thetaM)[<span class="fu">names</span>(q95thetaM) <span class="sc">==</span> <span class="st">'X2'</span>] <span class="ot">&lt;-</span> <span class="st">'etaQ95'</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q95thetaM)[<span class="fu">names</span>(q95thetaM) <span class="sc">==</span> <span class="st">'X3'</span>] <span class="ot">&lt;-</span> <span class="st">'etaV195'</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q95thetaM)[<span class="fu">names</span>(q95thetaM) <span class="sc">==</span> <span class="st">'X4'</span>] <span class="ot">&lt;-</span> <span class="st">'etaV295'</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>thetaM <span class="ot">&lt;-</span> <span class="fu">cbind</span>(thetaM,q5thetaM,q95thetaM)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>thetaM<span class="sc">$</span>age<span class="ot">&lt;-</span>xdata<span class="sc">$</span>AGE[start]</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>thetaM<span class="sc">$</span>bw<span class="ot">&lt;-</span>xdata<span class="sc">$</span>WT[start]</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>cov <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"bw"</span>)</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (z <span class="cf">in</span> <span class="fu">seq_along</span>(cov)) {</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(thetaM, <span class="fu">aes_string</span>(<span class="at">x=</span>cov[z], <span class="at">y=</span><span class="st">"etaCL"</span>)) <span class="sc">+</span> </span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>etaCL5, <span class="at">ymax=</span>etaCL95), <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.05</span>))<span class="sc">+</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"gray"</span>, <span class="at">linetype=</span><span class="st">"dotted"</span>)</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(thetaM, <span class="fu">aes_string</span>(<span class="at">x=</span>cov[z], <span class="at">y=</span><span class="st">"etaQ"</span>)) <span class="sc">+</span> </span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>etaQ5, <span class="at">ymax=</span>etaQ95), <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.05</span>))<span class="sc">+</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"gray"</span>, <span class="at">linetype=</span><span class="st">"dotted"</span>)</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>p3<span class="ot">&lt;-</span><span class="fu">ggplot</span>(thetaM, <span class="fu">aes_string</span>(<span class="at">x=</span>cov[z], <span class="at">y=</span><span class="st">"etaV1"</span>)) <span class="sc">+</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>etaV15, <span class="at">ymax=</span>etaV195), <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.05</span>))<span class="sc">+</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"gray"</span>, <span class="at">linetype=</span><span class="st">"dotted"</span>)</span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>p4<span class="ot">&lt;-</span><span class="fu">ggplot</span>(thetaM, <span class="fu">aes_string</span>(<span class="at">x=</span>cov[z],<span class="at">y=</span><span class="st">"etaV2"</span>)) <span class="sc">+</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>etaV25, <span class="at">ymax=</span>etaV295), <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.05</span>))<span class="sc">+</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"gray"</span>, <span class="at">linetype=</span><span class="st">"dotted"</span>)</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>plot1234 <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(<span class="at">grobs =</span> <span class="fu">list</span>(p1, p2, p3, p4), <span class="at">nraw=</span><span class="dv">4</span>)</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">"../deliv/figures/covariance-plots-"</span>, cov[z],<span class="st">".png"</span>),</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot=</span>plot1234, </span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">15</span>, <span class="at">height =</span> <span class="dv">15</span>, <span class="at">units =</span> <span class="st">"cm"</span>,  <span class="at">dpi=</span><span class="dv">300</span>)</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/covariets-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/covariets-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="gof" class="level2">
<h2 class="anchored" data-anchor-id="gof">GOF</h2>
<div class="cell" data-hash="clonidine_cache/html/GOF_a750e824a777c6b891518d81d7b0b071">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a> yobs <span class="ot">&lt;-</span> xdata<span class="sc">$</span>DV[iObs]</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a> p1 <span class="ot">&lt;-</span> <span class="fu">ppc_intervals</span>(<span class="at">y =</span> <span class="dv">1000</span><span class="sc">+</span>yobs, <span class="at">yrep =</span> yrepCond1[,], <span class="at">x =</span> yobs) <span class="sc">+</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">xlab</span>(<span class="st">"Observed (ng/ml)"</span>) <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ylab</span>(<span class="st">"Individual predictions (ng/ml)"</span>) <span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">100</span>)) <span class="sc">+</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color=</span><span class="st">"grey"</span>, <span class="at">linetype=</span><span class="st">"dotted"</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a> p2 <span class="ot">&lt;-</span><span class="fu">ppc_intervals</span>(<span class="at">y =</span> <span class="dv">1000</span><span class="sc">+</span>yobs, <span class="at">yrep =</span> yrepPred1[,], <span class="at">x =</span> yobs) <span class="sc">+</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Observed (ng/ml)"</span>) <span class="sc">+</span> </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ylab</span>(<span class="st">"Population predictions (ng/ml)"</span>) <span class="sc">+</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color=</span><span class="st">"grey"</span>, <span class="at">linetype=</span><span class="st">"dotted"</span>)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a> plot12 <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(<span class="at">grobs =</span> <span class="fu">list</span>(p1, p2), <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">nraw=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="clonidine_files/figure-html/GOF-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggsave</span>(<span class="st">"../deliv/figures/gof.png"</span>, </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot=</span>plot12, </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">15</span>, <span class="at">height =</span> <span class="dv">15</span>, <span class="at">units =</span> <span class="st">"cm"</span>,  <span class="at">dpi=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="references" class="level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body" role="list">
<div id="ref-hobbs_commensurate_2012" class="csl-entry" role="listitem">
Hobbs, B.P., Sargent, D.J. and Carlin, B.P. (2012) <span>“Commensurate priors for incorporating historical information in clinical trials using general and generalized linear models,”</span> <em>Bayesian Analysis</em>, 7(3), pp. 639–674. Available at: <a href="https://doi.org/10.1214/12-BA722">https://doi.org/10.1214/12-BA722</a>.
</div>
<div id="ref-potts_clonidine_2007" class="csl-entry" role="listitem">
Potts, A.L., Larsson, P., Eksborg, S., Warman, G., Lönnqvist, P.-A. and Anderson, B.J. (2007) <span>“Clonidine disposition in children; a population analysis,”</span> <em>Paediatric Anaesthesia</em>, 17(10), pp. 924–933. Available at: <a href="https://doi.org/10.1111/j.1460-9592.2007.02251.x">https://doi.org/10.1111/j.1460-9592.2007.02251.x</a>.
</div>
</div>
</section>
<section id="licenses" class="level1 unnumbered">
<h1 class="unnumbered">Licenses</h1>
<ul>
<li>Code &amp; copy; 2023, Paweł Wiczling, licensed under BSD-3.</li>
<li>Text &amp; copy; 2023, Paweł Wiczling, licensed under CC-BY-NC 4.0.</li>
</ul>
</section>
<section id="original-computing-environment" class="level1 unnumbered">
<h1 class="unnumbered">Original Computing Environment</h1>
<div class="cell" data-hash="clonidine_cache/html/unnamed-chunk-1_e94ed356923166b9052957b74aaca109">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.1.3 (2022-03-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 22621)

Matrix products: default

locale:
[1] LC_COLLATE=Polish_Poland.1250  LC_CTYPE=Polish_Poland.1250   
[3] LC_MONETARY=Polish_Poland.1250 LC_NUMERIC=C                  
[5] LC_TIME=Polish_Poland.1250    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] bayesplot_1.9.0      posterior_1.3.1      dplyr_1.1.2         
[4] tidyr_1.3.0          rstan_2.21.7         StanHeaders_2.21.0-7
[7] gridExtra_2.3        ggplot2_3.4.2        cmdstanr_0.5.3      

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.9           prettyunits_1.1.1    ps_1.7.1            
 [4] digest_0.6.29        utf8_1.2.2           R6_2.5.1            
 [7] plyr_1.8.7           ggridges_0.5.3       backports_1.4.1     
[10] stats4_4.1.3         evaluate_0.16        pillar_1.9.0        
[13] rlang_1.1.0          rstudioapi_0.14      callr_3.7.2         
[16] checkmate_2.1.0      rmarkdown_2.16       textshaping_0.3.6   
[19] labeling_0.4.2       stringr_1.5.0        htmlwidgets_1.5.4   
[22] loo_2.5.1            munsell_0.5.0        compiler_4.1.3      
[25] xfun_0.32            systemfonts_1.0.4    pkgconfig_2.0.3     
[28] pkgbuild_1.3.1       htmltools_0.5.3      tidyselect_1.2.0    
[31] tibble_3.2.1         tensorA_0.36.2       codetools_0.2-18    
[34] matrixStats_0.62.0   fansi_1.0.3          crayon_1.5.1        
[37] withr_2.5.0          grid_4.1.3           distributional_0.3.1
[40] jsonlite_1.8.4       gtable_0.3.1         lifecycle_1.0.3     
[43] magrittr_2.0.3       scales_1.2.1         RcppParallel_5.1.5  
[46] cli_3.4.0            stringi_1.7.8        reshape2_1.4.4      
[49] farver_2.1.1         ragg_1.2.5           generics_0.1.3      
[52] vctrs_0.6.2          tools_4.1.3          glue_1.6.2          
[55] purrr_1.0.1          processx_3.7.0       abind_1.4-5         
[58] parallel_4.1.3       fastmap_1.1.0        yaml_2.3.5          
[61] inline_0.3.19        colorspace_2.0-3     knitr_1.40          </code></pre>
</div>
</div>
<p><br></p>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb35" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Bayesing-based popPK modeling of clonidine with informative priors"</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Paweł Wiczling*"</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: "Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen. J. Hallera 107, 80-416 Gdańsk, Poland"</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.Date())`"</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true  </span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 7</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 7</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="fu"># Setup</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>The codes are based on STAN/Torsten manual <span class="ot">&lt;https://metrumresearchgroup.github.io/Torsten/&gt;</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>The packages we will use are listed below.</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, message=FALSE}</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="co">#' Instaling Stan and Torsten might be difficult. Follow this advice in case of any troubles:</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="co">#' https://discourse.mc-stan.org/t/installation-on-windows-revisited/20207</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="co">#' https://github.com/stan-dev/cmdstan/issues/909</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="fu">set_cmdstan_path</span>(<span class="st">"C:/Users/pawel/Documents/.cmdstan/Torsten-master/Torsten-master/cmdstan"</span>)</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="co"># library(shinystan)</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="do">## not required but assures repeatable results</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>The aim of this case study was to develop a population pharmacokinetic model of clonidine using Bayesian methods and an open-source programming environment RStudio, the programming language Stan and a library of pharmacokinetic tools Torsten.</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a><span class="in">```{r knitr-options, include=FALSE}</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache=</span><span class="cn">TRUE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">error=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">out.width=</span><span class="st">'95%'</span>)</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data</span></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>The analyzed PK data was obtained from 17 children (Department of Pediatric Anesthesiology and Intensive Care in Poznan). The results presented in the publication by Potts et al. <span class="co">[</span><span class="ot">@potts_clonidine_2007</span><span class="co">]</span> were used as a prior information (a meta-analysis of five studies conducted in Sweden and New Zealand). The head of the analyzed data:</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-data, include=TRUE}</span></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>xdata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/data-clonidine.csv"</span>)</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(xdata)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"ID"</span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>xdata<span class="sc">$</span>TINF <span class="ot">&lt;-</span> xdata<span class="sc">$</span>TINF<span class="sc">/</span><span class="dv">60</span>;</span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>xdata<span class="sc">$</span>DV <span class="ot">&lt;-</span> xdata<span class="sc">$</span>DV<span class="sc">/</span><span class="dv">1000</span>;</span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a>xdata<span class="sc">$</span>MDV[<span class="dv">107</span>] <span class="ot">&lt;-</span> <span class="dv">1</span>;</span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>xdata<span class="sc">$</span>EVID[<span class="dv">107</span>] <span class="ot">&lt;-</span> <span class="dv">1</span>;</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>xdata<span class="sc">$</span>OUTLIERS <span class="ot">=</span> xdata<span class="sc">$</span>DV<span class="sc">&gt;</span><span class="dv">20</span>;</span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>xdata<span class="sc">$</span>INFUSION <span class="ot">=</span> xdata<span class="sc">$</span>TIMEh<span class="sc">&lt;</span>xdata<span class="sc">$</span>TINF;</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>xdata<span class="sc">$</span>TIMEPOST <span class="ot">=</span> xdata<span class="sc">$</span>TIMEh<span class="sc">-</span>xdata<span class="sc">$</span>TINF;</span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xdata)</span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a><span class="fu">## Raw Data</span></span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a>First a simple graphical presentation of the data. Red plots denote outliers of unknown origin.</span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-raw-data, include=TRUE}</span></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a>plot1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">subset</span>(xdata, EVID <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> OUTLIERS<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> INFUSION<span class="sc">==</span><span class="dv">1</span>), </span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> TIMEh, <span class="at">y =</span> DV, <span class="at">group =</span> ID)) <span class="sc">+</span> </span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(xdata, EVID <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> OUTLIERS<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> INFUSION<span class="sc">==</span><span class="dv">1</span>), </span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> TIMEh, <span class="at">y =</span> DV, <span class="at">group =</span> ID),<span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">250</span>))<span class="sc">+</span></span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Clonindne, ng/ml"</span>) <span class="sc">+</span></span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time after infutions start, h"</span>) <span class="sc">+</span> </span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a>plot2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">subset</span>(xdata, EVID <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> OUTLIERS<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> INFUSION<span class="sc">==</span><span class="dv">0</span>), </span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> TIMEPOST, <span class="at">y =</span> DV, <span class="at">group =</span> ID)) <span class="sc">+</span> </span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(xdata, EVID <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> OUTLIERS<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> INFUSION<span class="sc">==</span><span class="dv">0</span>), </span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> TIMEPOST, <span class="at">y =</span> DV, <span class="at">group =</span> ID),<span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">250</span>))<span class="sc">+</span></span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Clonindne, ng/ml"</span>) <span class="sc">+</span></span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time after infusion end, h"</span>)<span class="sc">+</span></span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a>plot12 <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(plot1, plot2, <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../deliv/figures/raw-data.png"</span>, </span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot=</span>plot12, </span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">15</span>, <span class="at">height =</span> <span class="dv">15</span>, <span class="at">units =</span> <span class="st">"cm"</span>,  <span class="at">dpi=</span><span class="dv">300</span>)</span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a><span class="fu"># Methods</span></span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model</span></span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a>The data was analyzed using a 2 comp. PK model <span class="co">[</span><span class="ot">1</span><span class="co">]</span>.</span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a>&amp; V_1 \cdot \frac{dC_1}{dt} = Input(t) - CL \cdot  C_1 - Q \cdot  C_1 + Q \cdot  C_2 <span class="sc">\\</span></span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a>&amp; V_2 \cdot \frac{dC_2}{dt} =  Q \cdot  C1 - Q \cdot  C_2</span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a>where $C_1$ and $C_2$ denote clonidine concentrations in plasma and peripheral compartment. $Input(t)$ denotes clonidine dosing specific for a patient. The statistical model has the following structure (hierarchical model):</span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a>&amp; \log C_{Obs_{i,j}} \sim student_t(\nu_1,f_1(P_{i},t_{i,j}),\sigma_1) <span class="sc">\\</span></span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a>&amp; \log P_{i} \sim \text{MVN}(\log \theta_P + logfr_P+ allo_P \cdot \log(BW_i/70) + maturation_i, \Omega) <span class="sc">\\</span></span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a>&amp; maturation_i = log(1-(1-\beta) \cdot exp(-(4 \cdot AGE_i) \cdot 0.693/Tcl)) \ for \ CL \ only</span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a>where $P_i=(CL_{i}, Q_{i}, V1_{i}, V2_{i})$ is a vector of subject-specific parameters, $f_1(.)$ corresponds to the above ODE equations, $MVN$ is a multivariate normal distribution, $\theta_P$ is a vector of typical values of $P_i$, $allo_p$ is a vector of slopes between $P_i$ and $BW_i$. $maturation_i$ denotes a maturation function for CL. In turn, $\sigma$ is the scale and $\Omega$ is the scale matrix for the random effects related to the residual and unexplained between-subject variability. $fr_{P}$ is the difference between the literature and studied population. For convenience $\Omega$ was decomposed to:</span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a>\Omega = diag(\omega) \cdot LL' \cdot diag(\omega) </span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a>where $\rho = LL'$ denotes correlation, $L$ is a lower triangular Cholesky factor for a correlation matrix and $\omega$ denotes standard deviation for between subject variability.</span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a><span class="fu">## Priors</span></span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a>The priors were specified based on parameter estimates provided by Potts et al. <span class="co">[</span><span class="ot">@potts_clonidine_2007</span><span class="co">]</span>.</span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a>&amp; \theta_{CL} \sim lognormal(log(14.6),0.06), <span class="sc">\\</span></span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a>&amp; \theta_{Q} \sim lognormal(log(157),0.111), <span class="sc">\\</span></span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a>&amp; \theta_{V1} \sim lognormal(log(62.5),0.17), <span class="sc">\\</span></span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a>&amp; \theta_{V2} \sim lognormal(log(119),0.087), <span class="sc">\\</span></span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a>&amp; \beta \sim lognormal(log(0.262),0.274), <span class="sc">\\</span></span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a>&amp; Tcl \sim lognormal(log(25.7),0.294), <span class="sc">\\</span></span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a>&amp; fr_{CL}, fr_{Q},fr_{V1},fr_{V2} \sim lognormal(log(1),0.25), <span class="sc">\\</span></span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a>&amp; \nu \sim gamma(2,0.1),<span class="sc">\\</span></span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a>&amp; \omega_{CL}\sim lognormal(log(0.351),0.25), <span class="sc">\\</span></span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a>&amp; \omega_{Q} \sim lognormal(log(0.773),0.25), <span class="sc">\\</span></span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a>&amp; \omega_{V_1} \sim lognormal(log(0.711),0.25), <span class="sc">\\</span> </span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a>&amp; \omega_{V_2} \sim lognormal(log(0.229),0.25), <span class="sc">\\</span></span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a>&amp; allo_{CL},allo_{Q} \sim normal(0.75,0.05), <span class="sc">\\</span></span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a>&amp; allo_{V_1}, allo_{V_2} \sim normal(1,0.05), <span class="sc">\\</span></span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a>&amp; \sigma_{1}\sim lognormal(log(0.2),0.05), <span class="sc">\\</span></span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a>&amp; p(LL') \propto LKJ(4) \cdot \Pi_u N(c_u, 0.125), <span class="sc">\\</span></span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a>&amp; c_u = <span class="co">[</span><span class="ot">0.538,-0.036,0.323,-0.110,-0.199,-0.144</span><span class="co">]</span></span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a>  \end{aligned}</span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a>LKJ(4) ensure that the density is uniform over correlation matrices of order 4 and u denotes the unique lower triangular elements of correlation matrix (<span class="ot">&lt;http://srmart.in/informative-priors-for-correlation-matrices-an-easy-approach/&gt;</span>)</span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a>$fr$ is a form of a commensurate prior <span class="co">[</span><span class="ot">@hobbs_commensurate_2012</span><span class="co">]</span>.</span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a><span class="fu"># Format data for Stan</span></span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r standata, include=TRUE}</span></span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a>xdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(xdata, OUTLIERS <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a><span class="co">#' Format data for Stan</span></span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a>nt <span class="ot">&lt;-</span> <span class="fu">nrow</span>(xdata)</span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a>iObs <span class="ot">&lt;-</span> <span class="fu">with</span>(xdata, (<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(xdata))[EVID <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(iObs)</span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a>xsub <span class="ot">&lt;-</span> <span class="fu">subset</span>(xdata, <span class="sc">!</span><span class="fu">duplicated</span>(ID))</span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a>nSubjects <span class="ot">&lt;-</span> <span class="fu">length</span>(xsub<span class="sc">$</span>ID)</span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nt)[<span class="sc">!</span><span class="fu">duplicated</span>(xdata<span class="sc">$</span>ID)]</span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nt)</span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a>nIIV <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a>weight<span class="ot">&lt;-</span> xdata<span class="sc">$</span>WT</span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> xdata<span class="sc">$</span>AGEM</span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> xdata<span class="sc">$</span>TIMEh</span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a>cObs <span class="ot">&lt;-</span> xdata<span class="sc">$</span>DV[iObs]</span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a>amt <span class="ot">&lt;-</span>  xdata<span class="sc">$</span>AMT</span>
<span id="cb35-192"><a href="#cb35-192" aria-hidden="true" tabindex="-1"></a>rate <span class="ot">&lt;-</span> xdata<span class="sc">$</span>RATE</span>
<span id="cb35-193"><a href="#cb35-193" aria-hidden="true" tabindex="-1"></a>cmt <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">+</span>xdata<span class="sc">$</span>AGEM<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb35-194"><a href="#cb35-194" aria-hidden="true" tabindex="-1"></a>evid <span class="ot">&lt;-</span> xdata<span class="sc">$</span>EVID</span>
<span id="cb35-195"><a href="#cb35-195" aria-hidden="true" tabindex="-1"></a>ii <span class="ot">&lt;-</span> xdata<span class="sc">$</span>AGEM<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a>addl <span class="ot">&lt;-</span> xdata<span class="sc">$</span>AGEM<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> xdata<span class="sc">$</span>AGEM<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a>runestimation<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a><span class="co">#' create stan data set</span></span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a> data_list <span class="ot">&lt;-</span> <span class="fu">with</span>(xdata,</span>
<span id="cb35-202"><a href="#cb35-202" aria-hidden="true" tabindex="-1"></a>             <span class="fu">list</span>(<span class="at">nt =</span> nt,</span>
<span id="cb35-203"><a href="#cb35-203" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nObs =</span> nObs,</span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nSubjects =</span> nSubjects,</span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nIIV =</span> <span class="dv">4</span>,</span>
<span id="cb35-206"><a href="#cb35-206" aria-hidden="true" tabindex="-1"></a>                  <span class="at">iObs =</span> iObs,</span>
<span id="cb35-207"><a href="#cb35-207" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> start,</span>
<span id="cb35-208"><a href="#cb35-208" aria-hidden="true" tabindex="-1"></a>                  <span class="at">end =</span> end,</span>
<span id="cb35-209"><a href="#cb35-209" aria-hidden="true" tabindex="-1"></a>                  <span class="at">weight=</span> WT,</span>
<span id="cb35-210"><a href="#cb35-210" aria-hidden="true" tabindex="-1"></a>                  <span class="at">age =</span> AGEM,</span>
<span id="cb35-211"><a href="#cb35-211" aria-hidden="true" tabindex="-1"></a>                  <span class="at">time =</span> TIMEh,</span>
<span id="cb35-212"><a href="#cb35-212" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cObs =</span> DV[iObs],</span>
<span id="cb35-213"><a href="#cb35-213" aria-hidden="true" tabindex="-1"></a>                  <span class="at">amt =</span>  AMT,</span>
<span id="cb35-214"><a href="#cb35-214" aria-hidden="true" tabindex="-1"></a>                  <span class="at">rate =</span> RATE,</span>
<span id="cb35-215"><a href="#cb35-215" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cmt =</span> <span class="dv">2</span><span class="sc">+</span>AGEM<span class="sc">*</span><span class="dv">0</span>,</span>
<span id="cb35-216"><a href="#cb35-216" aria-hidden="true" tabindex="-1"></a>                  <span class="at">evid =</span> EVID,</span>
<span id="cb35-217"><a href="#cb35-217" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ii =</span> AGEM<span class="sc">*</span><span class="dv">0</span>,</span>
<span id="cb35-218"><a href="#cb35-218" aria-hidden="true" tabindex="-1"></a>                  <span class="at">addl =</span> AGEM<span class="sc">*</span><span class="dv">0</span>,</span>
<span id="cb35-219"><a href="#cb35-219" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ss =</span> AGEM<span class="sc">*</span><span class="dv">0</span>,</span>
<span id="cb35-220"><a href="#cb35-220" aria-hidden="true" tabindex="-1"></a>                  <span class="at">runestimation=</span><span class="dv">1</span>))</span>
<span id="cb35-221"><a href="#cb35-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-222"><a href="#cb35-222" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(data_list, <span class="st">"../standata/model_data.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-223"><a href="#cb35-223" aria-hidden="true" tabindex="-1"></a>data_list<span class="sc">$</span>runestimation<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb35-224"><a href="#cb35-224" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(data_list, <span class="st">"../standata/prior_model_data.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-225"><a href="#cb35-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-226"><a href="#cb35-226" aria-hidden="true" tabindex="-1"></a><span class="co">#' create initial estimates</span></span>
<span id="cb35-227"><a href="#cb35-227" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb35-228"><a href="#cb35-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">CLHat =</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="fl">14.6</span>),<span class="fl">0.25</span>)),</span>
<span id="cb35-229"><a href="#cb35-229" aria-hidden="true" tabindex="-1"></a>       <span class="at">QHat =</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="dv">157</span>),<span class="fl">0.5</span>)),</span>
<span id="cb35-230"><a href="#cb35-230" aria-hidden="true" tabindex="-1"></a>       <span class="at">V1Hat =</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="fl">62.5</span>),<span class="fl">0.5</span>)),</span>
<span id="cb35-231"><a href="#cb35-231" aria-hidden="true" tabindex="-1"></a>       <span class="at">V2Hat =</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="dv">119</span>),<span class="fl">0.5</span>)),</span>
<span id="cb35-232"><a href="#cb35-232" aria-hidden="true" tabindex="-1"></a>       <span class="at">betaHat =</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(<span class="fl">0.262</span>),<span class="fl">0.25</span>)),</span>
<span id="cb35-233"><a href="#cb35-233" aria-hidden="true" tabindex="-1"></a>       <span class="at">TclHat =</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fu">log</span>(<span class="fl">25.7</span>),<span class="fl">0.25</span>)),</span>
<span id="cb35-234"><a href="#cb35-234" aria-hidden="true" tabindex="-1"></a>       <span class="at">allo =</span> <span class="fu">c</span>(<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">4</span>,<span class="dv">0</span>,<span class="fl">0.25</span>)),</span>
<span id="cb35-235"><a href="#cb35-235" aria-hidden="true" tabindex="-1"></a>       <span class="at">fr =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">4</span>,<span class="dv">0</span>,<span class="fl">0.25</span>)),</span>
<span id="cb35-236"><a href="#cb35-236" aria-hidden="true" tabindex="-1"></a>       <span class="at">nu =</span> <span class="fu">max</span>(<span class="dv">3</span>,<span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="fl">0.1</span>)),</span>
<span id="cb35-237"><a href="#cb35-237" aria-hidden="true" tabindex="-1"></a>       <span class="at">omega =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>) <span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="fl">0.25</span>)),</span>
<span id="cb35-238"><a href="#cb35-238" aria-hidden="true" tabindex="-1"></a>       <span class="at">L =</span> <span class="fu">diag</span>(<span class="dv">4</span>),</span>
<span id="cb35-239"><a href="#cb35-239" aria-hidden="true" tabindex="-1"></a>       <span class="at">sigma =</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fu">log</span>(<span class="fl">0.2</span>),<span class="fl">0.25</span>)),</span>
<span id="cb35-240"><a href="#cb35-240" aria-hidden="true" tabindex="-1"></a>       <span class="at">etaStd =</span> <span class="fu">matrix</span>(0L, <span class="dv">4</span>, nSubjects))</span>
<span id="cb35-241"><a href="#cb35-241" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-242"><a href="#cb35-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-243"><a href="#cb35-243" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-244"><a href="#cb35-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-245"><a href="#cb35-245" aria-hidden="true" tabindex="-1"></a>The Stan/Torsten model is as follows:</span>
<span id="cb35-246"><a href="#cb35-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-247"><a href="#cb35-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stancode}</span></span>
<span id="cb35-248"><a href="#cb35-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-249"><a href="#cb35-249" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="fu">readLines</span>(<span class="st">"../model/clonidine.stan"</span>))</span>
<span id="cb35-250"><a href="#cb35-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-251"><a href="#cb35-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-252"><a href="#cb35-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-253"><a href="#cb35-253" aria-hidden="true" tabindex="-1"></a><span class="fu">## Inference</span></span>
<span id="cb35-254"><a href="#cb35-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-255"><a href="#cb35-255" aria-hidden="true" tabindex="-1"></a><span class="in">```{r compile-model, include=TRUE}</span></span>
<span id="cb35-256"><a href="#cb35-256" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="st">"../model/clonidine.stan"</span>)</span>
<span id="cb35-257"><a href="#cb35-257" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-258"><a href="#cb35-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-259"><a href="#cb35-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{r inferences, include=TRUE, eval=FALSE}</span></span>
<span id="cb35-260"><a href="#cb35-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-261"><a href="#cb35-261" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> model<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb35-262"><a href="#cb35-262" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">"../standata/model_data.json"</span>,</span>
<span id="cb35-263"><a href="#cb35-263" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb35-264"><a href="#cb35-264" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb35-265"><a href="#cb35-265" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb35-266"><a href="#cb35-266" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.9</span>,</span>
<span id="cb35-267"><a href="#cb35-267" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb35-268"><a href="#cb35-268" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init</span>
<span id="cb35-269"><a href="#cb35-269" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb35-270"><a href="#cb35-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-271"><a href="#cb35-271" aria-hidden="true" tabindex="-1"></a>  fit0 <span class="ot">&lt;-</span> model<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb35-272"><a href="#cb35-272" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">"../standata/prior_model_data.json"</span>,</span>
<span id="cb35-273"><a href="#cb35-273" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb35-274"><a href="#cb35-274" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb35-275"><a href="#cb35-275" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb35-276"><a href="#cb35-276" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb35-277"><a href="#cb35-277" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init</span>
<span id="cb35-278"><a href="#cb35-278" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-279"><a href="#cb35-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-280"><a href="#cb35-280" aria-hidden="true" tabindex="-1"></a><span class="co">#' save</span></span>
<span id="cb35-281"><a href="#cb35-281" aria-hidden="true" tabindex="-1"></a> fit<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">"../standata/fit.RDS"</span>)</span>
<span id="cb35-282"><a href="#cb35-282" aria-hidden="true" tabindex="-1"></a> fit0<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">"../standata/fit0.RDS"</span>)</span>
<span id="cb35-283"><a href="#cb35-283" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-284"><a href="#cb35-284" aria-hidden="true" tabindex="-1"></a><span class="co">#' save stanfit obj for shiny</span></span>
<span id="cb35-285"><a href="#cb35-285" aria-hidden="true" tabindex="-1"></a> stanfit <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">read_stan_csv</span>(fit<span class="sc">$</span><span class="fu">output_files</span>())</span>
<span id="cb35-286"><a href="#cb35-286" aria-hidden="true" tabindex="-1"></a> <span class="fu">saveRDS</span>(stanfit, <span class="st">"../standata/stanfit.RDS"</span>)</span>
<span id="cb35-287"><a href="#cb35-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-288"><a href="#cb35-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-289"><a href="#cb35-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-290"><a href="#cb35-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r loadfits, include=TRUE}</span></span>
<span id="cb35-291"><a href="#cb35-291" aria-hidden="true" tabindex="-1"></a><span class="co">#' fit is read back using readRDS - for speed</span></span>
<span id="cb35-292"><a href="#cb35-292" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../standata/fit.RDS"</span>)</span>
<span id="cb35-293"><a href="#cb35-293" aria-hidden="true" tabindex="-1"></a> fit0 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../standata/fit0.RDS"</span>)</span>
<span id="cb35-294"><a href="#cb35-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-295"><a href="#cb35-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-296"><a href="#cb35-296" aria-hidden="true" tabindex="-1"></a><span class="fu">## lounch shiny</span></span>
<span id="cb35-297"><a href="#cb35-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-298"><a href="#cb35-298" aria-hidden="true" tabindex="-1"></a><span class="in">```{r shiny, include=TRUE, eval=FALSE}</span></span>
<span id="cb35-299"><a href="#cb35-299" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(shinystan)</span>
<span id="cb35-300"><a href="#cb35-300" aria-hidden="true" tabindex="-1"></a> stanfit<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"../standata/stanfit.RDS"</span>)</span>
<span id="cb35-301"><a href="#cb35-301" aria-hidden="true" tabindex="-1"></a> <span class="fu">launch_shinystan</span>(stanfit)</span>
<span id="cb35-302"><a href="#cb35-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-303"><a href="#cb35-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-304"><a href="#cb35-304" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results</span></span>
<span id="cb35-305"><a href="#cb35-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-306"><a href="#cb35-306" aria-hidden="true" tabindex="-1"></a><span class="fu">## Priors</span></span>
<span id="cb35-307"><a href="#cb35-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-308"><a href="#cb35-308" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plotprior, include=TRUE}</span></span>
<span id="cb35-309"><a href="#cb35-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-310"><a href="#cb35-310" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit0<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"CLHat"</span>,<span class="st">"QHat"</span>,<span class="st">"V1Hat"</span>,<span class="st">"V2Hat"</span>))) </span>
<span id="cb35-311"><a href="#cb35-311" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit0<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"betaHat"</span>,<span class="st">"TclHat"</span>))) </span>
<span id="cb35-312"><a href="#cb35-312" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit0<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"fr"</span>))) </span>
<span id="cb35-313"><a href="#cb35-313" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit0<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"sigma"</span>,<span class="st">"nu"</span>)))</span>
<span id="cb35-314"><a href="#cb35-314" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit0<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"omega"</span>))</span>
<span id="cb35-315"><a href="#cb35-315" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit0<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"allo"</span>))</span>
<span id="cb35-316"><a href="#cb35-316" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit0<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"rho"</span>))) </span>
<span id="cb35-317"><a href="#cb35-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-318"><a href="#cb35-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-319"><a href="#cb35-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-320"><a href="#cb35-320" aria-hidden="true" tabindex="-1"></a><span class="fu">## Posteriors</span></span>
<span id="cb35-321"><a href="#cb35-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-322"><a href="#cb35-322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plotposterior, include=TRUE}</span></span>
<span id="cb35-323"><a href="#cb35-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-324"><a href="#cb35-324" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"CLHat"</span>,<span class="st">"QHat"</span>,<span class="st">"V1Hat"</span>,<span class="st">"V2Hat"</span>))) </span>
<span id="cb35-325"><a href="#cb35-325" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"betaHat"</span>,<span class="st">"TclHat"</span>))) </span>
<span id="cb35-326"><a href="#cb35-326" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"fr"</span>))) </span>
<span id="cb35-327"><a href="#cb35-327" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"sigma"</span>,<span class="st">"nu"</span>)))</span>
<span id="cb35-328"><a href="#cb35-328" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"omega"</span>))</span>
<span id="cb35-329"><a href="#cb35-329" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"allo"</span>))</span>
<span id="cb35-330"><a href="#cb35-330" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"rho"</span>))) </span>
<span id="cb35-331"><a href="#cb35-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-332"><a href="#cb35-332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-333"><a href="#cb35-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-334"><a href="#cb35-334" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb35-335"><a href="#cb35-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-336"><a href="#cb35-336" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summary, include=TRUE}</span></span>
<span id="cb35-337"><a href="#cb35-337" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="fu">c</span>(<span class="st">"CLHat"</span>,<span class="st">"QHat"</span>,<span class="st">"V1Hat"</span>,<span class="st">"V2Hat"</span>, </span>
<span id="cb35-338"><a href="#cb35-338" aria-hidden="true" tabindex="-1"></a>            <span class="st">"betaHat"</span>,<span class="st">"TclHat"</span>, <span class="st">"fr"</span>, <span class="st">"sigma"</span>, </span>
<span id="cb35-339"><a href="#cb35-339" aria-hidden="true" tabindex="-1"></a>            <span class="st">"nu"</span>, <span class="st">"omega"</span>, <span class="st">"allo"</span>, <span class="st">"rho"</span>), <span class="at">max_rows =</span> <span class="dv">30</span>)</span>
<span id="cb35-340"><a href="#cb35-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-341"><a href="#cb35-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-342"><a href="#cb35-342" aria-hidden="true" tabindex="-1"></a><span class="fu">## Individual and population predictions</span></span>
<span id="cb35-343"><a href="#cb35-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-344"><a href="#cb35-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r concordanceplots, include=TRUE}</span></span>
<span id="cb35-345"><a href="#cb35-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-346"><a href="#cb35-346" aria-hidden="true" tabindex="-1"></a>yrepCond1 <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"cObsCond"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb35-347"><a href="#cb35-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"cObsCond"</span>)) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb35-348"><a href="#cb35-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-349"><a href="#cb35-349" aria-hidden="true" tabindex="-1"></a>yrepPred1 <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"cObsPred"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb35-350"><a href="#cb35-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"cObsPred"</span>)) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb35-351"><a href="#cb35-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-352"><a href="#cb35-352" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> xdata<span class="sc">$</span>TIME[iObs]  <span class="co">#(read from data)</span></span>
<span id="cb35-353"><a href="#cb35-353" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> xdata<span class="sc">$</span>ID[iObs]   <span class="co">#(read from data)</span></span>
<span id="cb35-354"><a href="#cb35-354" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">unique</span>(id)</span>
<span id="cb35-355"><a href="#cb35-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-356"><a href="#cb35-356" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (z <span class="cf">in</span> <span class="fu">seq_along</span>(idx)) {</span>
<span id="cb35-357"><a href="#cb35-357" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-358"><a href="#cb35-358" aria-hidden="true" tabindex="-1"></a>  yobs <span class="ot">&lt;-</span> xdata<span class="sc">$</span>DV[iObs] </span>
<span id="cb35-359"><a href="#cb35-359" aria-hidden="true" tabindex="-1"></a>  ktore <span class="ot">&lt;-</span> (id <span class="sc">==</span> idx[z])</span>
<span id="cb35-360"><a href="#cb35-360" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-361"><a href="#cb35-361" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> bayesplot<span class="sc">::</span><span class="fu">ppc_ribbon</span>(<span class="at">y =</span> yobs[ktore], <span class="at">yrep =</span> yrepCond1[, ktore], <span class="at">x =</span> t[ktore]) <span class="sc">+</span></span>
<span id="cb35-362"><a href="#cb35-362" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="st">"Time (h)"</span>) <span class="sc">+</span></span>
<span id="cb35-363"><a href="#cb35-363" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"Clonidine (ng/ml)"</span>) <span class="sc">+</span></span>
<span id="cb35-364"><a href="#cb35-364" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> t[ktore], <span class="at">y =</span> yobs[ktore]), <span class="at">mapping =</span> <span class="fu">aes</span>(x, y), <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb35-365"><a href="#cb35-365" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggtitle</span>(<span class="fu">sprintf</span>(<span class="st">"Individual, id=%d"</span>, idx[z])) <span class="sc">+</span></span>
<span id="cb35-366"><a href="#cb35-366" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb35-367"><a href="#cb35-367" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expand_limits</span>(<span class="at">y=</span><span class="dv">0</span>)</span>
<span id="cb35-368"><a href="#cb35-368" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-369"><a href="#cb35-369" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> bayesplot<span class="sc">::</span><span class="fu">ppc_ribbon</span>(<span class="at">y =</span> yobs[ktore], <span class="at">yrep =</span> yrepPred1[, ktore], <span class="at">x =</span> t[ktore]) <span class="sc">+</span></span>
<span id="cb35-370"><a href="#cb35-370" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="st">"Time (h)"</span>)<span class="sc">+</span></span>
<span id="cb35-371"><a href="#cb35-371" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> t[ktore], <span class="at">y =</span> yobs[ktore]), <span class="at">mapping =</span> <span class="fu">aes</span>(x, y), <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb35-372"><a href="#cb35-372" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggtitle</span>(<span class="fu">sprintf</span>(<span class="st">"Population, id=%d"</span>, idx[z]))<span class="sc">+</span></span>
<span id="cb35-373"><a href="#cb35-373" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb35-374"><a href="#cb35-374" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expand_limits</span>(<span class="at">y=</span><span class="dv">0</span>)</span>
<span id="cb35-375"><a href="#cb35-375" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-376"><a href="#cb35-376" aria-hidden="true" tabindex="-1"></a>  plot12 <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(<span class="at">grobs =</span> <span class="fu">list</span>(p1, p2), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb35-377"><a href="#cb35-377" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-378"><a href="#cb35-378" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">"../deliv/figures/concordance-plots-id-"</span>, idx[z],<span class="st">".png"</span>),</span>
<span id="cb35-379"><a href="#cb35-379" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot=</span>plot12, </span>
<span id="cb35-380"><a href="#cb35-380" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">15</span>, <span class="at">height =</span> <span class="dv">15</span>, <span class="at">units =</span> <span class="st">"cm"</span>,  <span class="at">dpi=</span><span class="dv">300</span>)</span>
<span id="cb35-381"><a href="#cb35-381" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-382"><a href="#cb35-382" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-383"><a href="#cb35-383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-384"><a href="#cb35-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-385"><a href="#cb35-385" aria-hidden="true" tabindex="-1"></a><span class="fu">## Individual parameters vs. covariates</span></span>
<span id="cb35-386"><a href="#cb35-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-387"><a href="#cb35-387" aria-hidden="true" tabindex="-1"></a><span class="in">```{r covariets, include=TRUE}</span></span>
<span id="cb35-388"><a href="#cb35-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-389"><a href="#cb35-389" aria-hidden="true" tabindex="-1"></a>thetaM<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">log</span>(<span class="fu">matrix</span>(fit<span class="sc">$</span><span class="fu">summary</span>(<span class="st">"etaM"</span>)<span class="sc">$</span>mean, <span class="at">nrow =</span> <span class="fu">length</span>(start))))</span>
<span id="cb35-390"><a href="#cb35-390" aria-hidden="true" tabindex="-1"></a>q5thetaM<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">log</span>(<span class="fu">matrix</span>(fit<span class="sc">$</span><span class="fu">summary</span>(<span class="st">"etaM"</span>)<span class="sc">$</span>q5, <span class="at">nrow =</span> <span class="fu">length</span>(start))))</span>
<span id="cb35-391"><a href="#cb35-391" aria-hidden="true" tabindex="-1"></a>q95thetaM<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">log</span>(<span class="fu">matrix</span>(fit<span class="sc">$</span><span class="fu">summary</span>(<span class="st">"etaM"</span>)<span class="sc">$</span>q95, <span class="at">nrow =</span> <span class="fu">length</span>(start))))</span>
<span id="cb35-392"><a href="#cb35-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-393"><a href="#cb35-393" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(thetaM)[<span class="fu">names</span>(thetaM) <span class="sc">==</span> <span class="st">'X1'</span>] <span class="ot">&lt;-</span> <span class="st">'etaCL'</span></span>
<span id="cb35-394"><a href="#cb35-394" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(thetaM)[<span class="fu">names</span>(thetaM) <span class="sc">==</span> <span class="st">'X2'</span>] <span class="ot">&lt;-</span> <span class="st">'etaQ'</span></span>
<span id="cb35-395"><a href="#cb35-395" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(thetaM)[<span class="fu">names</span>(thetaM) <span class="sc">==</span> <span class="st">'X3'</span>] <span class="ot">&lt;-</span> <span class="st">'etaV1'</span></span>
<span id="cb35-396"><a href="#cb35-396" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(thetaM)[<span class="fu">names</span>(thetaM) <span class="sc">==</span> <span class="st">'X4'</span>] <span class="ot">&lt;-</span> <span class="st">'etaV2'</span></span>
<span id="cb35-397"><a href="#cb35-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-398"><a href="#cb35-398" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q5thetaM)[<span class="fu">names</span>(q5thetaM) <span class="sc">==</span> <span class="st">'X1'</span>] <span class="ot">&lt;-</span> <span class="st">'etaCL5'</span></span>
<span id="cb35-399"><a href="#cb35-399" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q5thetaM)[<span class="fu">names</span>(q5thetaM) <span class="sc">==</span> <span class="st">'X2'</span>] <span class="ot">&lt;-</span> <span class="st">'etaQ5'</span></span>
<span id="cb35-400"><a href="#cb35-400" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q5thetaM)[<span class="fu">names</span>(q5thetaM) <span class="sc">==</span> <span class="st">'X3'</span>] <span class="ot">&lt;-</span> <span class="st">'etaV15'</span></span>
<span id="cb35-401"><a href="#cb35-401" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q5thetaM)[<span class="fu">names</span>(q5thetaM) <span class="sc">==</span> <span class="st">'X4'</span>] <span class="ot">&lt;-</span> <span class="st">'etaV25'</span></span>
<span id="cb35-402"><a href="#cb35-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-403"><a href="#cb35-403" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q95thetaM)[<span class="fu">names</span>(q95thetaM) <span class="sc">==</span> <span class="st">'X1'</span>] <span class="ot">&lt;-</span> <span class="st">'etaCL95'</span></span>
<span id="cb35-404"><a href="#cb35-404" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q95thetaM)[<span class="fu">names</span>(q95thetaM) <span class="sc">==</span> <span class="st">'X2'</span>] <span class="ot">&lt;-</span> <span class="st">'etaQ95'</span></span>
<span id="cb35-405"><a href="#cb35-405" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q95thetaM)[<span class="fu">names</span>(q95thetaM) <span class="sc">==</span> <span class="st">'X3'</span>] <span class="ot">&lt;-</span> <span class="st">'etaV195'</span></span>
<span id="cb35-406"><a href="#cb35-406" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(q95thetaM)[<span class="fu">names</span>(q95thetaM) <span class="sc">==</span> <span class="st">'X4'</span>] <span class="ot">&lt;-</span> <span class="st">'etaV295'</span></span>
<span id="cb35-407"><a href="#cb35-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-408"><a href="#cb35-408" aria-hidden="true" tabindex="-1"></a>thetaM <span class="ot">&lt;-</span> <span class="fu">cbind</span>(thetaM,q5thetaM,q95thetaM)</span>
<span id="cb35-409"><a href="#cb35-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-410"><a href="#cb35-410" aria-hidden="true" tabindex="-1"></a>thetaM<span class="sc">$</span>age<span class="ot">&lt;-</span>xdata<span class="sc">$</span>AGE[start]</span>
<span id="cb35-411"><a href="#cb35-411" aria-hidden="true" tabindex="-1"></a>thetaM<span class="sc">$</span>bw<span class="ot">&lt;-</span>xdata<span class="sc">$</span>WT[start]</span>
<span id="cb35-412"><a href="#cb35-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-413"><a href="#cb35-413" aria-hidden="true" tabindex="-1"></a>cov <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"bw"</span>)</span>
<span id="cb35-414"><a href="#cb35-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-415"><a href="#cb35-415" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (z <span class="cf">in</span> <span class="fu">seq_along</span>(cov)) {</span>
<span id="cb35-416"><a href="#cb35-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-417"><a href="#cb35-417" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(thetaM, <span class="fu">aes_string</span>(<span class="at">x=</span>cov[z], <span class="at">y=</span><span class="st">"etaCL"</span>)) <span class="sc">+</span> </span>
<span id="cb35-418"><a href="#cb35-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb35-419"><a href="#cb35-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>etaCL5, <span class="at">ymax=</span>etaCL95), <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.05</span>))<span class="sc">+</span></span>
<span id="cb35-420"><a href="#cb35-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"gray"</span>, <span class="at">linetype=</span><span class="st">"dotted"</span>)</span>
<span id="cb35-421"><a href="#cb35-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-422"><a href="#cb35-422" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(thetaM, <span class="fu">aes_string</span>(<span class="at">x=</span>cov[z], <span class="at">y=</span><span class="st">"etaQ"</span>)) <span class="sc">+</span> </span>
<span id="cb35-423"><a href="#cb35-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb35-424"><a href="#cb35-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>etaQ5, <span class="at">ymax=</span>etaQ95), <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.05</span>))<span class="sc">+</span></span>
<span id="cb35-425"><a href="#cb35-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"gray"</span>, <span class="at">linetype=</span><span class="st">"dotted"</span>)</span>
<span id="cb35-426"><a href="#cb35-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-427"><a href="#cb35-427" aria-hidden="true" tabindex="-1"></a>p3<span class="ot">&lt;-</span><span class="fu">ggplot</span>(thetaM, <span class="fu">aes_string</span>(<span class="at">x=</span>cov[z], <span class="at">y=</span><span class="st">"etaV1"</span>)) <span class="sc">+</span></span>
<span id="cb35-428"><a href="#cb35-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb35-429"><a href="#cb35-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>etaV15, <span class="at">ymax=</span>etaV195), <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.05</span>))<span class="sc">+</span></span>
<span id="cb35-430"><a href="#cb35-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"gray"</span>, <span class="at">linetype=</span><span class="st">"dotted"</span>)</span>
<span id="cb35-431"><a href="#cb35-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-432"><a href="#cb35-432" aria-hidden="true" tabindex="-1"></a>p4<span class="ot">&lt;-</span><span class="fu">ggplot</span>(thetaM, <span class="fu">aes_string</span>(<span class="at">x=</span>cov[z],<span class="at">y=</span><span class="st">"etaV2"</span>)) <span class="sc">+</span></span>
<span id="cb35-433"><a href="#cb35-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb35-434"><a href="#cb35-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>etaV25, <span class="at">ymax=</span>etaV295), <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.05</span>))<span class="sc">+</span></span>
<span id="cb35-435"><a href="#cb35-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"gray"</span>, <span class="at">linetype=</span><span class="st">"dotted"</span>)</span>
<span id="cb35-436"><a href="#cb35-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-437"><a href="#cb35-437" aria-hidden="true" tabindex="-1"></a>plot1234 <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(<span class="at">grobs =</span> <span class="fu">list</span>(p1, p2, p3, p4), <span class="at">nraw=</span><span class="dv">4</span>)</span>
<span id="cb35-438"><a href="#cb35-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-439"><a href="#cb35-439" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">"../deliv/figures/covariance-plots-"</span>, cov[z],<span class="st">".png"</span>),</span>
<span id="cb35-440"><a href="#cb35-440" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot=</span>plot1234, </span>
<span id="cb35-441"><a href="#cb35-441" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">15</span>, <span class="at">height =</span> <span class="dv">15</span>, <span class="at">units =</span> <span class="st">"cm"</span>,  <span class="at">dpi=</span><span class="dv">300</span>)</span>
<span id="cb35-442"><a href="#cb35-442" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-443"><a href="#cb35-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-444"><a href="#cb35-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-445"><a href="#cb35-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-446"><a href="#cb35-446" aria-hidden="true" tabindex="-1"></a><span class="fu">## GOF</span></span>
<span id="cb35-447"><a href="#cb35-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-448"><a href="#cb35-448" aria-hidden="true" tabindex="-1"></a><span class="in">```{r GOF, include=TRUE}</span></span>
<span id="cb35-449"><a href="#cb35-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-450"><a href="#cb35-450" aria-hidden="true" tabindex="-1"></a> yobs <span class="ot">&lt;-</span> xdata<span class="sc">$</span>DV[iObs]</span>
<span id="cb35-451"><a href="#cb35-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-452"><a href="#cb35-452" aria-hidden="true" tabindex="-1"></a> p1 <span class="ot">&lt;-</span> <span class="fu">ppc_intervals</span>(<span class="at">y =</span> <span class="dv">1000</span><span class="sc">+</span>yobs, <span class="at">yrep =</span> yrepCond1[,], <span class="at">x =</span> yobs) <span class="sc">+</span> </span>
<span id="cb35-453"><a href="#cb35-453" aria-hidden="true" tabindex="-1"></a>   <span class="fu">xlab</span>(<span class="st">"Observed (ng/ml)"</span>) <span class="sc">+</span></span>
<span id="cb35-454"><a href="#cb35-454" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ylab</span>(<span class="st">"Individual predictions (ng/ml)"</span>) <span class="sc">+</span></span>
<span id="cb35-455"><a href="#cb35-455" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">100</span>)) <span class="sc">+</span> </span>
<span id="cb35-456"><a href="#cb35-456" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb35-457"><a href="#cb35-457" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb35-458"><a href="#cb35-458" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color=</span><span class="st">"grey"</span>, <span class="at">linetype=</span><span class="st">"dotted"</span>)</span>
<span id="cb35-459"><a href="#cb35-459" aria-hidden="true" tabindex="-1"></a> p2 <span class="ot">&lt;-</span><span class="fu">ppc_intervals</span>(<span class="at">y =</span> <span class="dv">1000</span><span class="sc">+</span>yobs, <span class="at">yrep =</span> yrepPred1[,], <span class="at">x =</span> yobs) <span class="sc">+</span></span>
<span id="cb35-460"><a href="#cb35-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Observed (ng/ml)"</span>) <span class="sc">+</span> </span>
<span id="cb35-461"><a href="#cb35-461" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ylab</span>(<span class="st">"Population predictions (ng/ml)"</span>) <span class="sc">+</span></span>
<span id="cb35-462"><a href="#cb35-462" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb35-463"><a href="#cb35-463" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb35-464"><a href="#cb35-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb35-465"><a href="#cb35-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color=</span><span class="st">"grey"</span>, <span class="at">linetype=</span><span class="st">"dotted"</span>)</span>
<span id="cb35-466"><a href="#cb35-466" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-467"><a href="#cb35-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-468"><a href="#cb35-468" aria-hidden="true" tabindex="-1"></a> plot12 <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(<span class="at">grobs =</span> <span class="fu">list</span>(p1, p2), <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">nraw=</span><span class="dv">1</span>)</span>
<span id="cb35-469"><a href="#cb35-469" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-470"><a href="#cb35-470" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggsave</span>(<span class="st">"../deliv/figures/gof.png"</span>, </span>
<span id="cb35-471"><a href="#cb35-471" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot=</span>plot12, </span>
<span id="cb35-472"><a href="#cb35-472" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">15</span>, <span class="at">height =</span> <span class="dv">15</span>, <span class="at">units =</span> <span class="st">"cm"</span>,  <span class="at">dpi=</span><span class="dv">300</span>)</span>
<span id="cb35-473"><a href="#cb35-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-474"><a href="#cb35-474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-475"><a href="#cb35-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-476"><a href="#cb35-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-477"><a href="#cb35-477" aria-hidden="true" tabindex="-1"></a><span class="fu"># References {.unnumbered}</span></span>
<span id="cb35-478"><a href="#cb35-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-479"><a href="#cb35-479" aria-hidden="true" tabindex="-1"></a>::: {#refs}</span>
<span id="cb35-480"><a href="#cb35-480" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb35-481"><a href="#cb35-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-482"><a href="#cb35-482" aria-hidden="true" tabindex="-1"></a><span class="fu"># Licenses {.unnumbered}</span></span>
<span id="cb35-483"><a href="#cb35-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-484"><a href="#cb35-484" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Code &amp; copy; 2023, Paweł Wiczling, licensed under BSD-3.</span>
<span id="cb35-485"><a href="#cb35-485" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Text &amp; copy; 2023, Paweł Wiczling, licensed under CC-BY-NC 4.0.</span>
<span id="cb35-486"><a href="#cb35-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-487"><a href="#cb35-487" aria-hidden="true" tabindex="-1"></a><span class="fu"># Original Computing Environment {.unnumbered}</span></span>
<span id="cb35-488"><a href="#cb35-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-491"><a href="#cb35-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-492"><a href="#cb35-492" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb35-493"><a href="#cb35-493" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-494"><a href="#cb35-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-495"><a href="#cb35-495" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br</span> <span class="kw">/&gt;</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>